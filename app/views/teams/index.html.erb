<%= content_for :body_attributes %>

<div class="large-12">
	<div class="row margin-bottom-2">
		<div class="large-12 columns">
			<img class="left margin-top-1 hide-for-small margin-right-1" src="/images/baseball.png" alt="Baseball" height="40" width="40">
			<img class="left show-for-small margin-top-05 margin-right-1" src="/images/baseball.png" alt="Baseball" height="30" width="30">
	    <div class="left">
	    	<h1 class="left no-margin hide-for-small ">Baseball Dashboard</h1>
	    	<h1 class="left no-margin show-for-small ">Baseball</h1>
				<h6 class="subheader" id="updating" style="display:<%if (!@update)%>none<%end%>">
					Refreshing All Teams 
					<%= image_tag '/images/refresh-animated.gif' %>
				</h6>
			</div>
		</div>
	</div>

	<%= render :partial => "dashboard_demo" %>

	<%= render :partial => "dashboard_website", 
		:object => @yahoo_teams, :as => "website",
		:locals => {
			:var_name => "Yahoo", 
			:var_updateteams => "yahoo", 
			:var_teamwindow => "YAHOO", 
		} 
	%>

	<%= render :partial => "dashboard_website", 
		:object => @espn_teams, :as => "website",
		:locals => {
			:var_name => "ESPN", 
			:var_updateteams => "espn", 
			:var_teamwindow => "ESPN", 
		} 
	%>

</div>


<SCRIPT>

function test(){
	console.log("clicked");
}

function show_active_inactive(teamid, setbool, type) {
	if (setbool) {
		$('#'+type+'_'+teamid+'_active').fadeIn();
		$('#'+type+'_'+teamid+'_inactive').hide();						
	} else {
		$('#'+type+'_'+teamid+'_active').hide();
		$('#'+type+'_'+teamid+'_inactive').fadeIn();						
	}
}

function setup(teamid, setbool, type) {	
	$.ajax({
        type: 'GET',
        dataType: "html",
        data: 'teamid='+escape(teamid)+'&setvalue='+escape(setbool)+'&playertype='+escape(type),
        cache: false,
        async: true, 
        url: '/teams/setup',
        success: show_active_inactive(teamid, setbool, type),
        error: function (request, status, error) {
        	console.log(request.responseText)
					$(type+'r_'+teamid).innerHTML = old_inner_html;
        },
        complete: function () {
			
        }
    });
}


$(document).ready(function() {
	updateTeams('all');

})

function teamWindow(type) {
Dialog.alert({url: "/teams/manage?teamType="+type, options: {method: 'get'}}, 
            { title:"Manage "+type+" Teams",className:"bluelighting", width:400, okLabel: "Close"});
            
}

function reload_team(){
	
	var number_espn_teams = <%=@espn_teams.length%>;
	var number_yahoo_teams = <%=@yahoo_teams.length%>;
		
	if ($('teamType').value=='ESPN' && number_espn_teams != 0) {
		if (!confirm('Are you sure you want to reload all teams?  You will lose all player roster settings if you continue.')) return;	
	}
	if ($('teamType').value=='YAHOO' && number_yahoo_teams != 0) {
		if (!confirm('Are you sure you want to reload all teams?  You will lose all player roster settings if you continue.')) return;	
	}
	
	
	$('manageAction').value = "R";
	$('manage_team').request({
	    onSuccess: successFunc,
  		onFailure:  failureFunc
	});
	$('team_popup').style.textAlign = "center";
	$('team_popup').innerHTML = "<H3>Loading Team Information <IMAGE SRC=\"/images/refresh-animated.gif\"></H3>"

}

function submit_team(){
	
	
	if (($('current_user').value != '')&&($('current_user').value != $('userid').value)){
		if (!confirm('Are you sure you want to change user id?  You will lose all player roster settings and reload new teams if you continue.')) return;
	}
	
	//Check User ID and Password Fields
	$('userid').disabled = false;
	if (($('userid').value == '') || ($('pass').value == '')){
		alert('User ID Field and/or Password Field can not be empty!')
		return;
	}
	
	$('manageAction').value = "U";
	$('manage_team').request({
	    onSuccess: successFunc,
  		onFailure:  failureFunc
	});
	$('team_popup').style.textAlign = "center";
	$('team_popup').innerHTML = "<H3>Loading Team Information <IMAGE SRC=\"/images/refresh-animated.gif\"></H3>"

}


function successFunc(response){
	
	if (response.responseText == 'true') window.location = "/teams";
	else {
	    var container = $('team_popup');    
    	container.update('Could not load team information.  Check ID / Password and try again.');
		}
    
}

function failureFunc(response){

    var container = $('team_popup');
    
    container.update('Error while loading information.  Please try again later.');
    
}

function activateUserField(){
	$('userid').disabled = false;
}

function activatePassField(){
	$('pass').disabled = false;
}
  
function updateTeams(mode) {
	$('updating').style.display = "";
	
	if (mode!='all') {
		$('updating').innerHTML = "Refreshing "+mode.toUpperCase()+" Teams <IMAGE SRC=\"/images/refresh-animated.gif\">"
	}

	$j.ajax({
        type: 'GET',
        dataType: "html",
        data: 'mode='+escape(mode),
        cache: false,
        async: true, 
        url: '/teams/update_all',
        success: function(html) {
			
            $j("#updating").html(html);
            //new Popup('popup_gamelog','popup_link_gamelog',{position:'center',trigger:'click'})
			//$('popup_gamelog').popup.show();
        },
        error: function () {
			$('updating').innerHTML = "Error Refreshing!";
        },
        complete: function () {
			
        }
    });
}
</SCRIPT>
